<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Server Mode Test</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  background: black;
  color: white;
  font-family: system-ui;
  overflow: hidden;
}

/* ===== SCREENS ===== */
#startScreen, #trainingScreen {
  position: fixed;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}

#trainingScreen { display: none; }

/* ===== BUTTON ===== */
button {
  padding: 20px 28px;
  font-size: 22px;
  font-weight: bold;
  border-radius: 16px;
  border: none;
  background: #3498db;
  color: white;
}

/* ===== VIDEO ===== */
video {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* ===== OVERLAY ===== */
#overlay {
  position: fixed;
  inset: 0;
  pointer-events: none;
  display: flex;
  justify-content: center;
  align-items: center;
}

#box {
  background: rgba(0,0,0,0.7);
  padding: 24px 32px;
  border-radius: 20px;
  text-align: center;
}

#counter {
  font-size: 96px;
  font-weight: 900;
}

#status {
  margin-top: 12px;
  font-size: 18px;
  opacity: 0.8;
}
</style>
</head>

<body>

<!-- ===== START ===== -->
<div id="startScreen">
  <button id="startBtn">–ù–ê–ß–ê–¢–¨ (—Å–µ—Ä–≤–µ—Ä–Ω—ã–π —Ä–µ–∂–∏–º)</button>
</div>

<!-- ===== TRAINING ===== -->
<div id="trainingScreen">
  <video id="video" playsinline muted></video>

  <div id="overlay">
    <div id="box">
      <div id="counter">0</div>
      <div id="status">–û–∂–∏–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞‚Ä¶</div>
    </div>
  </div>
</div>

<script>
const startBtn = document.getElementById('startBtn');
const startScreen = document.getElementById('startScreen');
const trainingScreen = document.getElementById('trainingScreen');

const video = document.getElementById('video');
const counterEl = document.getElementById('counter');
const statusEl = document.getElementById('status');

let reps = 0;
let sendInterval;

/* ===== START ===== */
startBtn.onclick = async () => {
  startScreen.style.display = 'none';
  trainingScreen.style.display = 'block';

  // üëâ –í–ê–ñ–ù–û: –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∫–∞–º–µ—Ä—É
  const stream = await navigator.mediaDevices.getUserMedia({ video: true });
  video.srcObject = stream;
  await video.play();

  statusEl.innerText = '–ö–∞–º–µ—Ä–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–∞–¥—Ä—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä‚Ä¶';

  // –Ω–∞—á–∏–Ω–∞–µ–º "–æ—Ç–ø—Ä–∞–≤–∫—É" –∫–∞–¥—Ä–æ–≤
  sendInterval = setInterval(sendFrameToServer, 700);
};

/* ===== MOCK SERVER REQUEST ===== */
async function sendFrameToServer() {
  // –±–µ—Ä—ë–º –∫–∞–¥—Ä
  const canvas = document.createElement('canvas');
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;

  const ctx = canvas.getContext('2d');
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

  // –∏–º–∏—Ç–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
  statusEl.innerText = '–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞–¥—Ä–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä‚Ä¶';

  const serverResponse = await mockServer(canvas);

  if (serverResponse.rep) {
    reps++;
    counterEl.innerText = reps;
    statusEl.innerText = '–ü—Ä–∏—Å–µ–¥ –∑–∞—Å—á–∏—Ç–∞–Ω —Å–µ—Ä–≤–µ—Ä–æ–º';
  } else {
    statusEl.innerText = '–°–µ—Ä–≤–µ—Ä: –¥–≤–∏–∂–µ–Ω–∏—è –Ω–µ—Ç';
  }
}

/* ===== MOCK SERVER ===== */
function mockServer(canvas) {
  return new Promise(resolve => {
    // –∏–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏ + –æ–±—Ä–∞–±–æ—Ç–∫–∏
    setTimeout(() => {
      // "—Å–µ—Ä–≤–µ—Ä" –∏–Ω–æ–≥–¥–∞ –≤–∏–¥–∏—Ç –ø—Ä–∏—Å–µ–¥
      resolve({ rep: Math.random() > 0.7 });
    }, 500);
  });
}
</script>

</body>
</html>
